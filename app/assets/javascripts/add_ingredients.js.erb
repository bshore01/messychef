$(document).ready(function(){

  $("#add_ingredients").children("select").select2();

  $("#add_more_ingredients").click(function (e) {
    e.preventDefault();

    addIngredient();
  });

  $("#add_ingredients").on('click', '.delete_this_ingredient', function(e){
    e.preventDefault();

    this.parentElement.remove();
  });
});

function addIngredient(){
  var numIngredients = $("#add_ingredients > div").length;

  $("#add_ingredients")
      .children("select")

      // call destroy to revert the changes made by Select2
      .select2("destroy").end()

      // append another ingredients select 
      .append(
        $("#add_ingredients").children("button").first().clone()
      ).append(
        $("#add_ingredients").children("select").first().clone()
      ).append(
        $("#add_ingredients").children("input").first().clone().val("")
      ).append(
        $("#add_ingredients").children("select").eq(1).clone()
      ).append(
        $("#add_ingredients").children("br").first().clone()
      );

  // enable Select2 on the select elements
  $("#add_ingredients").children("select").select2();
}