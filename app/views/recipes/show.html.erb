<script src="//code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
<script type="text/javascript" charset="utf-8">
  $(window).load(function() {


      messyChef.init();


    $('.flexslider').flexslider({
      slideshow: false
    });
  });

  window.onbeforeunload = function (e) {
    messyChef.stop();
  };
  
  $(function() {
    var progressTimer,
      progressbar = $( "#progressbar" ),
      progressLabel = $( ".progress-label" ),
      dialogButtons = [{
        text: "Cancel Download",
        click: closeDownload
      }],
      dialog = $( "#dialog" ).dialog({
        autoOpen: false,
        closeOnEscape: false,
        resizable: false,
        buttons: dialogButtons,
        open: function() {
          progressTimer = setTimeout( progress, 6000 );
        },
        beforeClose: function() {
          downloadButton.button( "option", {
            disabled: false,
            label: "Start Download"
          });
        }
      }),
      downloadButton = $( "#downloadButton" )
        .button()
        .on( "click", function() {
          $( this ).button( "option", {
            disabled: true,
            label: "Downloading..."
          });
          dialog.dialog( "open" );
        });
 
    progressbar.progressbar({
      value: false,
      change: function() {
        progressLabel.text( "Please give me a quick second" );
      },
      complete: function() {
        progressLabel.text( "Hmm, I'm sorry, you may want to refresh the page." );
        dialog.dialog( "option", "buttons", [{
          text: "Close",
          click: closeDownload
        }]);
        $(".ui-dialog button").last().focus();
      }
    });
 
    function progress() {
      var val = progressbar.progressbar( "value" ) || 0;
 
      progressbar.progressbar( "value", val + Math.floor( Math.random() * 3 ) );
 
      if ( val <= 99 ) {
        progressTimer = setTimeout( progress, 50 );
      }
    }
 
    function closeDownload() {
      clearTimeout( progressTimer );
      dialog
        .dialog( "option", "buttons", dialogButtons )
        .dialog( "close" );
      progressbar.progressbar( "value", false );
      progressLabel
        .text( "MessyChef is interpreting..." );
      downloadButton.focus();
    }
  });
  
</script>


<div class="inner-page padd">
  <div class="recipe">
    <div class="container">

      <div class="row">

        <h3><%= @recipe.title %></h3> 

        <div class="row col-md-8">

          <div class="row">
            <div class="col-md-8">
              <p><%= @recipe.description %></p>
              <div class="clearfix"></div>
            </div>
          </div>

          <hr>

          <div class="row">
            <div class="col-md-6 col-sm-6">
              <div class="recipe-item">
                <h5>Ingredients:</h5>
                <ul class="list-unstyled">
                  <% @recipe.recipe_ingredient_units.each do |riu| %>
                    <li>
                      <i class="fa fa-check">
                      </i>
                      <%= riu.amount %> <%= Unit.find(riu.unit_id).unit.pluralize(riu.amount) if riu.unit_id %> <%= Ingredient.find(riu.ingredient_id).name %>
                      <div class="clearfix"></div>
                    </li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>

          <hr>

          <div class="row">
            <div class="col-md-8">
              <div class="recipe-item">
                  <div id="interim">Start</div>
                  <span id="dialog" title="">
                    <img alt="Chef icon" class="img-responsive" style="margin-left:auto; margin-right: auto;"src="/assets/chef-icon.jpg">
                    <span class="progress-label">Interpreting your beautiful voice...</span>
                    <span id="progressbar"></span>
                  </span>
                  <button id="downloadButton">Start Download</button>
                <h5>Directions:</h5>
              </div>
            </div>
          </div>

        </div>

        <div>
          <p>Placeholder for user section.</p>
        </div>

      </div>

      <div class="flexslider">
        <ul class="slides">
          <% @recipe.directions.sort_by { |d| d.sequence }.each do |direction| %>
            <li>
              <div>
                <div style="padding: 10px 45px 10px 45px;">
                  <%= direction.sequence %>.
                  <%= direction.description.capitalize[0] + direction.description.slice(1..-1) %>
                </div>
              </div>
            </li>
          <% end %>
        </ul>
      </div>

      <div class="row">
        <%= link_to '<< Back', recipes_path, class: "btn btn-danger pull-left" %>
        &nbsp;&nbsp;
        <%= link_to 'Edit', edit_recipe_path(@recipe), class: "btn btn-danger" %>
      </div>

    </div>
  </div>
</div>